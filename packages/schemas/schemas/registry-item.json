{
  "$id": "https://schema.open-form.dev/registry-item.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "OpenForm Registry Item",
  "description": "Schema for registry item files (r/{name}.json)",
  "additionalProperties": true,
  "type": "object",
  "properties": {
    "$schema": {
      "format": "uri",
      "description": "JSON Schema URI for validation",
      "type": "string"
    },
    "kind": {
      "description": "Artifact kind",
      "anyOf": [
        {
          "const": "form",
          "type": "string"
        },
        {
          "const": "document",
          "type": "string"
        },
        {
          "const": "checklist",
          "type": "string"
        },
        {
          "const": "bundle",
          "type": "string"
        }
      ]
    },
    "name": {
      "pattern": "^[a-zA-Z0-9][a-zA-Z0-9-_]*$",
      "minLength": 1,
      "maxLength": 128,
      "description": "Artifact name",
      "type": "string"
    },
    "version": {
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+",
      "description": "Semantic version",
      "type": "string"
    },
    "title": {
      "minLength": 1,
      "maxLength": 200,
      "description": "Human-readable title",
      "type": "string"
    },
    "description": {
      "maxLength": 2000,
      "description": "Artifact description",
      "type": "string"
    },
    "layers": {
      "description": "Available layers",
      "type": "object",
      "patternProperties": {
        "^(.*)$": {
          "title": "RegistryLayer",
          "description": "Layer in a registry item - inline or file with URL",
          "anyOf": [
            {
              "title": "RegistryInlineLayer",
              "description": "Inline layer with embedded content",
              "type": "object",
              "allOf": [
                {
                  "type": "object",
                  "properties": {
                    "mimeType": {
                      "description": "MIME type of the layer content",
                      "minLength": 1,
                      "maxLength": 100,
                      "type": "string"
                    },
                    "title": {
                      "description": "Human-readable title for this layer",
                      "minLength": 1,
                      "maxLength": 200,
                      "type": "string"
                    },
                    "description": {
                      "description": "Description of what this layer represents",
                      "minLength": 1,
                      "maxLength": 2000,
                      "type": "string"
                    },
                    "checksum": {
                      "description": "SHA-256 checksum for integrity verification",
                      "pattern": "^sha256:[a-f0-9]{64}$",
                      "type": "string"
                    },
                    "bindings": {
                      "description": "Mapping from form field names to template identifiers",
                      "type": "object",
                      "patternProperties": {
                        "^(.*)$": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "required": [
                    "mimeType"
                  ]
                },
                {
                  "type": "object",
                  "properties": {
                    "kind": {
                      "const": "inline",
                      "type": "string"
                    },
                    "text": {
                      "description": "Layer content with interpolation placeholders",
                      "minLength": 1,
                      "maxLength": 1000000,
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "text"
                  ]
                }
              ]
            },
            {
              "title": "RegistryFileLayer",
              "description": "File-backed layer with download URL",
              "type": "object",
              "allOf": [
                {
                  "type": "object",
                  "properties": {
                    "mimeType": {
                      "description": "MIME type of the layer content",
                      "minLength": 1,
                      "maxLength": 100,
                      "type": "string"
                    },
                    "title": {
                      "description": "Human-readable title for this layer",
                      "minLength": 1,
                      "maxLength": 200,
                      "type": "string"
                    },
                    "description": {
                      "description": "Description of what this layer represents",
                      "minLength": 1,
                      "maxLength": 2000,
                      "type": "string"
                    },
                    "checksum": {
                      "description": "SHA-256 checksum for integrity verification",
                      "pattern": "^sha256:[a-f0-9]{64}$",
                      "type": "string"
                    },
                    "bindings": {
                      "description": "Mapping from form field names to template identifiers",
                      "type": "object",
                      "patternProperties": {
                        "^(.*)$": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "required": [
                    "mimeType"
                  ]
                },
                {
                  "type": "object",
                  "properties": {
                    "kind": {
                      "const": "file",
                      "type": "string"
                    },
                    "path": {
                      "description": "Relative path for the layer file when installed",
                      "minLength": 1,
                      "maxLength": 1000,
                      "type": "string"
                    },
                    "url": {
                      "format": "uri",
                      "description": "URL to download the layer file from",
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "path",
                    "url"
                  ]
                }
              ]
            }
          ]
        }
      }
    },
    "defaultLayer": {
      "description": "Default layer key",
      "type": "string"
    }
  },
  "required": [
    "kind",
    "name",
    "version"
  ]
}